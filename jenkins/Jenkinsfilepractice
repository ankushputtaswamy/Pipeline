pipeline {
agent any
        parameters {
        choice choices: ['BUILD', 'TESTING' , 'DEPLOY'], name: 'STAGES'
        string defaultValue: 'main', name: 'BRANCH', trim: true
        }

        environment {
        branch = "${BRANCH}"
        }

    stages {
        stage('BUILD') {
            when {
                expression{ params.STAGES == 'BUILD'}
                expression{ params.BRANCH == '$branch'}
            }
            steps {
                catchError(buildResult: 'SUCCESS' , stageResult: 'FAILURE') {
                    sh '''
                    echo "This is BUILD Stage $branch $STAGES $branch $STAGES"
                    '''
                }
            }
        }
        stage('TESTING') {
            when {
                expression{ params.STAGES == 'TESTING'}
                expression{ params.BRANCH == '$branch'}
            }
            parallel {
                stage('TESTING IN WINDOWS MACHINE') {
                    steps{
                        catchError(buildResult: 'SUCCESS' , stageResult: 'FAILURE') {
                        sh '''
                        echo "This is Testing stage in WINDOWS Machine $branch $STAGES"
                        '''
                        }
                    }
                }
                stage('TESTING IN LINUX MACHINE') {
                    steps{
                        catchError(buildResult: 'SUCCESS' , stageResult: 'FAILURE') {
                        sh '''
                        echo "This is Testing stage in LINUX Machine $branch $STAGES"
                        '''
                        }
                    }
                }
                stage('TESTING IN MAC MACHINE') {
                    steps{
                        catchError(buildResult: 'SUCCESS' , stageResult: 'FAILURE') {
                             sh '''
                        echo "This is Testing stage in MAC Machine $branch $STAGES"
                        '''
                        }
                    }
                }
            }
        }
        stage('DEPLOY') {
            when {
                expression{ params.STAGES == 'DEPLOY'}
                expression{ params.BRANCH == '$branch'}
            }
            steps {
                catchError(buildResult: 'SUCCESS' , stageResult: 'FAILURE') {
                    sh '''
                    echo "This is DEPLOY Stage $branch $STAGES"
                    '''
                }
            }
        }
    }
        post{
        always {
            echo "This will print always"
        }
        success{
            echo "The BUILD_ID $BUILD_ID is Success"
        }
        unstable{
            echo "The BUILD_ID $BUILD_ID is Unstable"
        }
        failure{
            echo "The BUILD_ID $BUILD_ID is Failure"
        }
    }
}